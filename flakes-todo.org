* +Making a nix-shell dev environment+
** The alternatives to poetry2nix don't work
** poetry2nix's mkPythonEnv
*** using the default.nix implementation from github
*** using it in a flake
Both of these methods run into a
#+begin_src bash
ModuleNotFoundError: No module named 'flit_core'
#+end_src
error, suggesting they are maybe equivalent.
**** Updating poetry2nix
I can specify specific commit hashes when inputting it as a flake, but I can't figure out how to reference mkPythonEnv as an attribute- I don't know what its path is
***** How to refer to mkPoetryEnv from the flake input
****** Understand the outputs specification by reading about eachDefaultSystem
****** Some other way of locating the path
*** Is the error fixed in poetry2nix or does it require a [[https://github.com/nix-community/poetry2nix/issues/568][workaround]]?
**** Fixed in poetry2nix
***** Figure out how to use newest version
****** [?] understand "overlays"
:LOGBOOK:
- State "[?]"        from              [2023-06-25 Sun 23:20]
:END:
****** [?] understand poetry2nix.overlay
:LOGBOOK:
- State "[?]"        from              [2023-06-25 Sun 23:20]
:END:
***** [?] Implement the workaround
:LOGBOOK:
- State "[?]"        from              [2023-06-25 Sun 23:21]
:END:

****** [?] is this the right syntax: =pkgs.python310.flit-core=
:LOGBOOK:
- State "[?]"        from              [2023-06-25 Sun 23:20]
:END:
****** [?]
:LOGBOOK:
- State "[?]"        from              [2023-06-25 Sun 23:21]
:END:
* Current state of the project
There are several workarounds for errors presented [[https://github.com/nix-community/poetry2nix/blob/master/docs/edgecases.md][here]]. In general, for errors like:
#+begin_src bash
ModuleNotFoundError: No module named 'flit_core'
#+end_src
Fill out the =bd= snippet.

[2023-06-29 Thu 18:32] Stopping after a very long stretch of no progress. See the commit =25f4b7e= for the current state and possible future steps. Big big issues here.
* Tensorflow fail log
:log:
/nix/store/nhzvgfpfw40k8627yv4gp46jynb2akfh-tensorflow-2.11.0.drv
@nix { "action": "setPhase", "phase": "unpackPhase" }
unpacking sources
unpacking source archive /nix/store/bx5sxw87vs9cpvcbqskpkasml2ip8pik-source
source root is source
@nix { "action": "setPhase", "phase": "patchPhase" }
patching sources
patching script interpreter paths in .
./third_party/gpus/crosstool/clang/bin/crosstool_wrapper_driver_is_not_gcc.tpl: interpreter >./third_party/gpus/crosstool/clang/bin/crosstool_wrapper_driver_rocm.tpl: interpreter direct>./tensorflow/go/test.sh: interpreter directive changed from "#!/usr/bin/env bash" to "/nix/s>./tensorflow/core/kernels/mlir_generated/build_test.sh: interpreter directive changed from ">@nix { "action": "setPhase", "phase": "unpackPhase" }
unpacking sources
unpacking source archive /nix/store/bx5sxw87vs9cpvcbqskpkasml2ip8pik-source
source root is source
@nix { "action": "setPhase", "phase": "patchPhase" }
patching sources
patching script interpreter paths in .
./third_party/gpus/crosstool/clang/bin/crosstool_wrapper_driver_is_not_gcc.tpl: interpreter >./third_party/gpus/crosstool/clang/bin/crosstool_wrapper_driver_rocm.tpl: interpreter direct>./tensorflow/go/test.sh: interpreter directive changed from "#!/usr/bin/env bash" to "/nix/s>./tensorflow/core/kernels/mlir_generated/build_test.sh: interpreter directive changed from ">./tensorflow/core/api_def/update_api_def.sh: interpreter directive changed from "#!/bin/bash>./tensorflow/python/tpu/client/pip_package/build_pip_package.sh: interpreter directive chang>./tensorflow/python/tpu/profiler/pip_package/build_pip_package.sh: interpreter directive cha>./tensorflow/python/debug/examples/v1/examples_v1_offline_analyzer_test.sh: interpreter dire>./tensorflow/python/debug/examples/v1/examples_v1_debug_errors_test.sh: interpreter directiv>./tensorflow/python/debug/examples/v1/examples_v1_debug_tflearn_iris_test.sh: interpreter di>./tensorflow/python/debug/examples/v1/examples_v1_debug_mnist_test.sh: interpreter directive>./tensorflow/python/debug/examples/v1/examples_v1_debug_keras_test.sh: interpreter directive>./tensorflow/python/debug/examples/v1/examples_v1_debug_fibonacci_test.sh: interpreter direc>./tensorflow/python/debug/examples/v1/examples_v1_test.sh: interpreter directive changed fro>./tensorflow/python/debug/examples/v2/examples_v2_test.sh: interpreter directive changed fro>./tensorflow/tools/tf_sig_build_dockerfiles/setup.python.sh: interpreter directive changed f>./tensorflow/tools/tf_sig_build_dockerfiles/setup.sources.sh: interpreter directive changed >./tensorflow/tools/tf_sig_build_dockerfiles/builder.devtoolset/fixlinks.sh: interpreter dire>./tensorflow/tools/tf_sig_build_dockerfiles/builder.devtoolset/build_devtoolset.sh: interpre>./tensorflow/tools/tf_sig_build_dockerfiles/builder.devtoolset/rpm-patch.sh: interpreter dir>./tensorflow/tools/tf_sig_build_dockerfiles/setup.packages.sh: interpreter directive changed>./tensorflow/tools/tf_sig_build_dockerfiles/devel.usertools/setup_venv_test.sh: interpreter >./tensorflow/tools/tf_sig_build_dockerfiles/devel.usertools/repack_libtensorflow.sh: interpr>./tensorflow/tools/tf_sig_build_dockerfiles/devel.usertools/get_test_list.sh: interpreter di>./tensorflow/tools/tf_sig_build_dockerfiles/devel.usertools/squash_testlogs.py: interpreter >./tensorflow/tools/tf_sig_build_dockerfiles/devel.usertools/rename_and_verify_wheels.sh: int>./tensorflow/tools/tf_sig_build_dockerfiles/setup.cuda.sh: interpreter directive changed fro>./tensorflow/tools/pip_package/build_pip_package.sh: interpreter directive changed from "#!/>./tensorflow/tools/gcs_test/gcs_smoke.sh: interpreter directive changed from "#!/usr/bin/env>./tensorflow/tools/gcs_test/gcs_smoke_wrapper.sh: interpreter directive changed from "#!/usr>./tensorflow/tools/lib_package/libtensorflow_test.sh: interpreter directive changed from "#!>./tensorflow/tools/lib_package/concat_licenses.sh: interpreter directive changed from "#!/us>./tensorflow/tools/lib_package/libtensorflow_java_test.sh: interpreter directive changed fro>./tensorflow/tools/android/test/gradlew: interpreter directive changed from "#!/usr/bin/env >./tensorflow/tools/dockerfiles/tests/build-gpu.sh: interpreter directive changed from "#!/us>./tensorflow/tools/dockerfiles/tests/build-mkl-horovod.sh: interpreter directive changed fro>./tensorflow/tools/dockerfiles/tests/import-onednn.sh: interpreter directive changed from "#>./tensorflow/tools/dockerfiles/tests/import-onednn-horovod.sh: interpreter directive changed>./tensorflow/tools/dockerfiles/tests/import-gpu.sh: interpreter directive changed from "#!/u>./tensorflow/tools/dockerfiles/tests/import.sh: interpreter directive changed from "#!/usr/b>./tensorflow/tools/dockerfiles/tests/build-cpu.sh: interpreter directive changed from "#!/us>./tensorflow/tools/ci_build/xla/linux/gpu/run_py3.sh: interpreter directive changed from "#!>./tensorflow/tools/ci_build/linux/libtensorflow_cpu.sh: interpreter directive changed from ">./tensorflow/tools/ci_build/linux/ppc64le/cpu/run_py3.sh: interpreter directive changed from>./tensorflow/tools/ci_build/linux/ppc64le/cpu/run_py2.sh: interpreter directive changed from>./tensorflow/tools/ci_build/linux/ppc64le/gpu/run_py3.sh: interpreter directive changed from>./tensorflow/tools/ci_build/linux/ppc64le/gpu/run_py2.sh: interpreter directive changed from>./tensorflow/tools/ci_build/linux/libtensorflow.sh: interpreter directive changed from "#!/u>./tensorflow/tools/ci_build/linux/cmake/run.sh: interpreter directive changed from "#!/usr/b>./tensorflow/tools/ci_build/linux/mkl/basic-mkl-test.sh: interpreter directive changed from >./tensorflow/tools/ci_build/linux/mkl/build-dev-container.sh: interpreter directive changed >./tensorflow/tools/ci_build/linux/mkl/install_openmpi_horovod.sh: interpreter directive chan>./tensorflow/tools/ci_build/linux/mkl/basic-mkl-gpu-test.sh: interpreter directive changed f>./tensorflow/tools/ci_build/linux/cpu/run_py3_contrib.sh: interpreter directive changed from>./tensorflow/tools/ci_build/linux/cpu/run_mkl.sh: interpreter directive changed from "#!/usr>./tensorflow/tools/ci_build/linux/cpu/run_py2_core.sh: interpreter directive changed from "#>./tensorflow/tools/ci_build/linux/cpu/run_cc_core.sh: interpreter directive changed from "#!>./tensorflow/tools/ci_build/linux/cpu/run_py3_core.sh: interpreter directive changed from "#>./tensorflow/tools/ci_build/linux/libtensorflow_rocm.sh: interpreter directive changed from >./tensorflow/tools/ci_build/linux/rocm/run_gpu_single.sh: interpreter directive changed from>./tensorflow/tools/ci_build/linux/rocm/rocm_py36_pip.sh: interpreter directive changed from >./tensorflow/tools/ci_build/linux/rocm/run_gpu_multi.sh: interpreter directive changed from >...skipping...
[145 / 3,853] Compiling absl/time/internal/cctz/src/time_zone_info.cc; 2s local ... (16 acti>[221 / 4,172] Compiling llvm/lib/Demangle/MicrosoftDemangleNodes.cpp; 1s local ... (16 actio>[231 / 4,172] Compiling mlir/tools/mlir-tblgen/AttrOrTypeDefGen.cpp; 4s local ... (16 action>[245 / 4,172] Compiling mlir/tools/mlir-tblgen/AttrOrTypeDefGen.cpp; 7s local ... (16 action>[263 / 4,172] Compiling mlir/tools/mlir-tblgen/OpDefinitionsGen.cpp; 10s local ... (16 actio>[289 / 4,172] Compiling mlir/tools/mlir-tblgen/OpDefinitionsGen.cpp; 14s local ... (16 actio>[326 / 4,172] Compiling llvm/lib/Support/ItaniumManglingCanonicalizer.cpp; 4s local ... (16 >[365 / 4,172] Compiling llvm/lib/Support/ItaniumManglingCanonicalizer.cpp; 9s local ... (16 >[402 / 4,172] Compiling llvm/lib/Support/CommandLine.cpp; 10s local ... (16 actions, 15 runn>[472 / 4,778] Compiling llvm/lib/Support/VirtualFileSystem.cpp; 10s local ... (16 actions, 1>[555 / 5,117] Compiling mlir/lib/Tools/PDLL/Parser/Parser.cpp; 7s local ... (16 actions, 15 >[1,088 / 5,117] Compiling llvm/utils/TableGen/AsmMatcherEmitter.cpp; 13s local ... (16 actio>[1,112 / 5,117] Compiling mlir/lib/Dialect/SparseTensor/IR/SparseTensorDialect.cpp; 15s loca>[1,147 / 5,117] Compiling mlir/lib/IR/BuiltinAttributes.cpp; 18s local ... (16 actions, 15 r>[1,185 / 5,117] Compiling llvm/utils/TableGen/GlobalISelEmitter.cpp; 14s local ... (16 actio>[1,285 / 5,117] Compiling llvm/lib/Support/ItaniumManglingCanonicalizer.cpp; 3s local ... (1>[1,496 / 5,310] Compiling mlir/tools/mlir-linalg-ods-gen/mlir-linalg-ods-yaml-gen.cpp; 12s l>[1,648 / 5,349] Compiling mlir/lib/IR/BuiltinAttributes.cpp; 22s local ... (16 actions, 15 r>[1,717 / 5,349] Compiling tensorflow/core/ir/ops.cc; 40s local ... (16 actions running)
[1,767 / 5,349] Compiling mlir/lib/Dialect/LLVMIR/IR/LLVMIntrinsicOps.cpp; 42s local ... (16>[1,831 / 5,349] Compiling tensorflow/compiler/xla/mlir_hlo/lib/Dialect/thlo/IR/thlo_ops.cc; >[1,879 / 5,349] Compiling tensorflow/compiler/xla/mlir_hlo/lib/Dialect/mhlo/transforms/legal>[1,976 / 5,349] Compiling mlir/lib/Dialect/Linalg/IR/LinalgOps.cpp; 39s local ... (16 action>[2,173 / 5,350] Compiling mlir/lib/Dialect/LLVMIR/IR/LLVMDialect.cpp; 76s local ... (16 acti>[2,334 / 5,350] Compiling mlir/lib/Dialect/Arith/IR/ArithOps.cpp; 29s local ... (16 actions,>[2,502 / 5,350] Compiling tensorflow/compiler/xla/mlir_hlo/lib/Dialect/lhlo/IR/lhlo_ops.cc; >[2,681 / 5,350] Compiling src/cpu/rnn/ref_rnn.cpp; 28s local ... (16 actions, 15 running)
[2,961 / 5,686] Compiling stablehlo/dialect/ChloOps.cpp; 40s local ... (16 actions, 15 runni>[3,186 / 5,686] Compiling stablehlo/dialect/StablehloOps.cpp; 53s local ... (16 actions, 15 >[3,463 / 5,686] Compiling tensorflow/compiler/xla/mlir_hlo/lib/Dialect/mhlo/IR/hlo_ops.cc; 9>[3,728 / 5,686] Compiling tensorflow/compiler/xla/service/hlo_parser.cc; 44s local ... (16 a>[3,883 / 5,686] Compiling tensorflow/core/util/batch_util.cc; 59s local ... (16 actions, 15 >[4,092 / 5,686] Compiling tensorflow/compiler/mlir/tensorflow/ir/tf_ops_n_z.cc; 159s local .>/nix/store/sw36plhp82916wwg6i6097rkzza7d950-stdenv-linux/setup: line 1638:  6042 Killed     >
:END:
